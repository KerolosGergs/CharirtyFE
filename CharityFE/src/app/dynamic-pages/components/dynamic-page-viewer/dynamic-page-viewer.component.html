@defer(on idle){
<div class="bg">
  <app-header-component></app-header-component>
  <app-nav></app-nav>
  
  <!-- Dynamic Page Content -->
  <div class="vision-mission-container p-4 rounded-4 shadow-sm bg-white animate__animated animate__fadeInUp" dir="rtl" *ngIf="!isLoading; else loadingTpl">
    <h2 class="fw-bold mb-4 text-success">
      <i class="bi bi-file-text me-2"></i> {{ page?.pageName }}
    </h2>
    
    <div class="page-description mb-4" *ngIf="page?.description">
      <p class="text-muted fs-6">{{ page?.description }}</p>
    </div>

    <ng-container *ngIf="items?.length; else emptyTpl">
      
      <!-- Text Items Section -->
      <div class="mb-4" *ngIf="getItemsByType('text').length > 0">
        <h3 class="fw-bold text-success mb-4 text-center">
          <i class="bi bi-text-paragraph me-2"></i> النصوص والمحتوى
        </h3>
        <div class="row g-4">
          <div class="col-md-6" *ngFor="let item of getItemsByType('text'); let i = index">
            <div class="card vision-mission-card h-100 animate__animated animate__fadeInUp">
              <div class="card-body">
                <h4 class="card-title text-success mb-3">
                  <i class="bi bi-stars me-2"></i> المحتوى {{ i + 1 }}
                </h4>
                <p class="card-text fs-5">{{ item.content }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Image + Text Items Section -->
      <div class="mb-4" *ngIf="getItemsByType('image_text').length > 0">
        <h3 class="fw-bold text-success mb-4 text-center">
          <i class="bi bi-image me-2"></i> الصور والمحتوى
        </h3>
        <div class="row g-4">
          <div class="col-12" *ngFor="let item of getItemsByType('image_text'); let i = index">
            <div class="card vision-mission-card animate__animated animate__fadeInUp">
              <div class="card-body">
                <h4 class="card-title text-success mb-3">
                  <i class="bi bi-image me-2"></i> المحتوى {{ i + 1 }}
                </h4>
                <div class="row g-3">
                  <div class="col-md-6" *ngIf="item.imageUrl as url">
                    <div class="image-container">
                      <img
                        [ngSrc]="safeUrl(url)"
                        width="400"
                        height="300"
                        class="content-image rounded-3 shadow-sm"
                        alt=""
                        priority="lazy"
                      />
                    </div>
                  </div>
                  <div class="col-md-6">
                    <p class="card-text fs-5">{{ item.content }}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- File Items Section - Updated to match regulations design -->
      <div class="mb-4" *ngIf="getItemsByType('file').length > 0">
        <h3 class="fw-bold text-success mb-4 text-center">
          <i class="bi bi-file-earmark me-2"></i> الملفات والوثائق
        </h3>
        
        <!-- Files Grid - Like regulations -->
        <div class="files-grid">
          <a 
            class="file-button" 
            *ngFor="let item of getItemsByType('file'); let i = index"
            (click)="selectFile(i)"
            [class.active]="selectedFileIndex === i"
          >
            {{ item.fileName || 'ملف ' + (i + 1) }}
          </a>
        </div>

        <!-- Display Selected PDF Using iframe -->
        <div class="py-3" *ngIf="selectedFileIndex !== null">
          <iframe 
            [src]="getSelectedFileUrl()" 
            width="100%" 
            height="600" 
            frameborder="0"
            class="pdf-iframe"
          ></iframe>
        </div>
      </div>

      <!-- Video Items Section - Like video-section design -->
      <div class="mb-4" *ngIf="getItemsByType('video').length > 0">
        <h3 class="fw-bold text-success mb-4 text-center">
          <i class="bi bi-play-circle me-2"></i> الفيديوهات
        </h3>
        <div class="row g-4">
          <div class="col-12" *ngFor="let item of getItemsByType('video'); let i = index">
            <div class="card vision-mission-card animate__animated animate__fadeInUp">
              <div class="card-body">
                <h4 class="card-title text-success mb-3">
                  <i class="bi bi-play-circle me-2"></i> {{ item.content }}
                </h4>
                <div class="video-container" *ngIf="item.videoUrl">
                  <div class="ratio ratio-16x9">
                    <iframe 
                      [src]="getVideoEmbedUrl(item.videoUrl)" 
                      class="video-iframe"
                      frameborder="0" 
                      allowfullscreen
                      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    ></iframe>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </ng-container>
  </div>
  
  <app-footer></app-footer>
</div>
}
@placeholder {
<app-spinner></app-spinner>
}
@error {
<app-not-found></app-not-found>
}

<ng-template #loadingTpl>
  <div class="bg">
    <app-header-component></app-header-component>
    <app-nav></app-nav>
    <div class="vision-mission-container p-4 rounded-4 shadow-sm bg-white d-flex flex-column align-items-center justify-content-center" style="min-height: 400px;">
      <div class="spinner-border text-success" role="status">
        <span class="visually-hidden">يتم التحميل...</span>
      </div>
      <p class="mt-3 text-success fw-medium">يتم تحميل المحتوى...</p>
    </div>
    <app-footer></app-footer>
  </div>
</ng-template>

<ng-template #emptyTpl>
  <div class="bg">
    <app-header-component></app-header-component>
    <app-nav></app-nav>
    <div class="vision-mission-container p-4 rounded-4 shadow-sm bg-white d-flex flex-column align-items-center justify-content-center" style="min-height: 400px;">
      <div class="empty-icon mb-3">
        <i class="bi bi-inbox text-success" style="font-size: 3rem;"></i>
      </div>
      <h3 class="text-success fw-bold">لا توجد عناصر لعرضها</h3>
      <p class="text-muted">لم يتم العثور على محتوى لهذه الصفحة</p>
    </div>
    <app-footer></app-footer>
  </div>
</ng-template>
