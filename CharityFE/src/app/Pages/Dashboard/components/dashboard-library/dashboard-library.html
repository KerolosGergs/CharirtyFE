<div class="container mx-auto p-4" dir="rtl">
  <!-- Filter Controls -->
  <div class="mb-4 d-flex justify-content-between align-items-center animate__animated animate__fadeIn">
    <div class="d-flex gap-3">
      <button class="btn" [ngClass]="filter === 'all' ? 'btn-success' : 'btn-outline-secondary'"
        (click)="setFilter('all')">
        <i class="bi bi-grid-fill ms-2"></i>الكل
      </button>
      <button class="btn" [ngClass]="filter === 'image' ? 'btn-success' : 'btn-outline-secondary'"
        (click)="setFilter('image')">
        <i class="bi bi-image ms-2"></i>الصور
      </button>
      <button class="btn" [ngClass]="filter === 'video' ? 'btn-success' : 'btn-outline-secondary'"
        (click)="setFilter('video')">
        <i class="bi bi-play-circle-fill ms-2"></i>الفيديوهات
      </button>
      <button class="btn" [ngClass]="statusFilter === 'all' ? 'btn-success' : 'btn-outline-secondary'"
        (click)="setStatusFilter('all')">
        <i class="bi bi-list ms-2"></i>كل الحالات
      </button>
      <button class="btn" [ngClass]="statusFilter === 'active' ? 'btn-success' : 'btn-outline-secondary'"
        (click)="setStatusFilter('active')">
        <i class="bi bi-check-circle-fill ms-2"></i>نشط
      </button>
      <button class="btn " [ngClass]="statusFilter === 'inactive' ? 'btn-success' : 'btn-outline-secondary'"
        (click)="setStatusFilter('inactive')">
        <i class="bi bi-x-circle-fill ms-2"></i>غير نشط
      </button>
    </div>
    <div class="d-flex gap-3">
      <button class="btn btn-success animate__animated animate__pulse animate__infinite"
        (click)="openForm('add', 'image')">
        <i class="bi bi-plus-circle-fill ms-2"></i>إضافة صورة
      </button>
      <button class="btn btn-success animate__animated animate__pulse animate__infinite"
        (click)="openForm('add', 'video')">
        <i class="bi bi-plus-circle-fill ms-2"></i>إضافة فيديو
      </button>
    </div>
  </div>

  <!-- Media Grid -->
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <ng-container *ngFor="let item of paginatedItems">
      <div class="col animate__animated animate__fadeInUp">
        <div class="card h-100 shadow-sm text-end">
          <div class="card-body">
            <h3 class="card-title">{{ item.name }}</h3>
            <ng-container *ngIf="'imageUrl' in item; else videoContent">
              <img [src]="item.imageUrl" [alt]="item.name" class="w-100 h-48 object-cover rounded mb-3"
                *ngIf="item.imageUrl" />
              <p *ngIf="!item.imageUrl" class="text-danger">رابط الصورة غير متوفر</p>
            </ng-container>
            <ng-template #videoContent>
              <iframe [src]="sanitizeUrl(item.id)" class="w-100 h-48 rounded mb-3" frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen></iframe>
            </ng-template>
            <p class="card-text text-muted fs-4">{{ item.description || 'لا يوجد وصف' }}</p>
            <p class="status-container fw-bold" [ngClass]="{'status-active': item.isActive, 'status-inactive': !item.isActive}">
              <span class="status-text">{{ item.isActive ? 'نشط' : 'غير نشط' }}</span>
            </p>
          </div>
          <div class="card-footer bg-transparent border-0 d-flex justify-content-between align-items-center ">
            <button class="btn btn-sm btn-outline-primary"
              (click)="openForm('edit', 'imageUrl' in item ? 'image' : 'video', item)">
              <i class="bi bi-pencil-square me-1"></i> تعديل
            </button>
            <button class="btn btn-sm btn-outline-danger" (click)="confirmDelete(item)">
              <i class="bi bi-trash3-fill me-1"></i> حذف
            </button>
          </div>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- Pagination Controls -->
  <nav *ngIf="pagination.totalPages > 1" aria-label="Appointments pagination">
    <ul class="pagination justify-content-center mt-4 animate__animated animate__fadeIn">
      <li class="page-item" [class.disabled]="pagination.currentPage === 1">
        <button class="page-link " (click)="onPageChange(pagination.currentPage - 1)">
          <i class="bi bi-chevron-left"></i>
        </button>
      </li>
      <li *ngFor="let page of getPageNumbers()" class="page-item" [class.active]="page === pagination.currentPage">
        <button class="page-link" (click)="onPageChange(page)">{{ page }}</button>
      </li>
      <li class="page-item" [class.disabled]="pagination.currentPage === pagination.totalPages">
        <button class="page-link" (click)="onPageChange(pagination.currentPage + 1)">
          <i class="bi bi-chevron-right"></i>
        </button>
      </li>
    </ul>
  </nav>

  <!-- Add/Edit Modal -->
  <div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display': showFormModal ? 'block' : 'none'}">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">{{ editMode ? 'تعديل العنصر' : formData.type === 'image' ? 'إضافة صورة جديدة' : 'إضافة
            فيديو جديد' }}</h4>
          <button type="button" class="btn-close" (click)="closeFormModal()"></button>
        </div>
        <div class="modal-body text-end">
          <div class="mb-3">
            <label class="form-label">الاسم</label>
            <input [(ngModel)]="formData.name" class="form-control" type="text" />
          </div>
          <div class="mb-3" *ngIf="formData.type === 'image'">
            <label class="form-label">الصورة</label>
            <input class="form-control" type="file" accept="image/*" (change)="onFileSelected($event)" />
            <img *ngIf="formData.url && !editMode" [src]="formData.url" class="w-100 h-48 object-cover rounded mt-3" />
          </div>
          <div class="mb-3" *ngIf="formData.type === 'video'">
            <label class="form-label">رابط الفيديو</label>
            <input [(ngModel)]="formData.url" class="form-control" type="text" />
          </div>
          <div class="mb-3">
            <label class="form-label">الوصف</label>
            <textarea [(ngModel)]="formData.description" class="form-control"></textarea>
          </div>
          @if(formData.name)
          {

          <div class="mb-3 form-check">
            <input [(ngModel)]="formData.isActive" type="checkbox" class="form-check-input" id="isActive" />
            <label class="form-check-label" for="isActive">نشط</label>
          </div>
          }
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" (click)="closeFormModal()">
            إلغاء
          </button>
          <button type="button" class="btn btn-primary" (click)="saveItem()">
            {{ editMode ? 'تحديث' : 'إضافة' }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Confirm Delete Modal -->
  <div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display': showConfirmDeleteModal ? 'block' : 'none'}">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">تأكيد الحذف</h4>
          <button type="button" class="btn-close" (click)="closeConfirmDeleteModal()"></button>
        </div>
        <div class="modal-body text-end">
          <p>هل أنت متأكد من حذف هذا العنصر؟</p>
          <p><strong>{{ itemToDelete?.name }}</strong></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" (click)="closeConfirmDeleteModal()">
            إلغاء
          </button>
          <button type="button" class="btn btn-danger" (click)="deleteItem()">
            حذف
          </button>
        </div>
      </div>
    </div>
  </div>
</div>