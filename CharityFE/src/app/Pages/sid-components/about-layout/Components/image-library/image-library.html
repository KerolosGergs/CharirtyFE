<div class="container mx-auto p-4" dir="rtl">
  <!-- Filter Controls -->
  <div class="mb-4 d-flex justify-content-center align-items-center animate__animated animate__fadeIn">
    <div class="d-flex gap-3">
      <button class="btn" [ngClass]="filter === 'all' ? 'btn-success' : 'btn-outline-secondary'"
        (click)="setFilter('all')">
        <i class="bi bi-grid-fill ms-2"></i>الكل
      </button>
      <button class="btn" [ngClass]="filter === 'image' ? 'btn-success' : 'btn-outline-secondary'"
        (click)="setFilter('image')">
        <i class="bi bi-image ms-2"></i>الصور
      </button>
      <button class="btn" [ngClass]="filter === 'video' ? 'btn-success' : 'btn-outline-secondary'"
        (click)="setFilter('video')">
        <i class="bi bi-play-circle-fill ms-2"></i>الفيديوهات
      </button>
    </div>
  </div>

  <!-- Media Grid -->
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    @for (item of paginatedItems; track $index) {
      <div class="col animate__animated animate__fadeInUp">
        <div class="card h-100 shadow-sm text-end">
          <div class="card-body">
            <h3 class="card-title">{{ item.name }}</h3>

            @if ('imageUrl' in item) {
              <img [src]="item.imageUrl" [alt]="item.name"
                class="w-100 h-48 object-cover rounded mb-3 clickable-image"
                (click)="openImage(item.imageUrl)" />
              @if (!item.imageUrl) {
                <p class="text-danger">رابط الصورة غير متوفر</p>
              }
            } @else {
              <iframe [src]="sanitizeUrl(item.id)" class="w-100 h-48 rounded mb-3" frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen></iframe>
            }

            <p class="card-text text-muted fs-4">{{ item.description || 'لا يوجد وصف' }}</p>
          </div>
        </div>
      </div>
    }
  </div>

  <!-- Pagination Controls -->
  @if (pagination.totalPages > 1) {
    <nav aria-label="Appointments pagination">
      <ul class="pagination justify-content-center mt-4 animate__animated animate__fadeIn">
        <li class="page-item" [class.disabled]="pagination.currentPage === 1">
          <button class="page-link" (click)="onPageChange(pagination.currentPage - 1)">
            <i class="bi bi-chevron-left"></i>
          </button>
        </li>
        @for (page of getPageNumbers(); track $index) {
          <li class="page-item" [class.active]="page === pagination.currentPage">
            <button class="page-link" (click)="onPageChange(page)">{{ page }}</button>
          </li>
        }
        <li class="page-item" [class.disabled]="pagination.currentPage === pagination.totalPages">
          <button class="page-link" (click)="onPageChange(pagination.currentPage + 1)">
            <i class="bi bi-chevron-right"></i>
          </button>
        </li>
      </ul>
    </nav>
  }

  <!-- Fullscreen Image Viewer -->
  @if (selectedImage) {
    <div class="image-viewer-overlay animate__animated animate__fadeIn">
      <span class="close-btn" (click)="closeImage()">&times;</span>
      <img [src]="selectedImage" class="image-viewer-img" />
    </div>
  }
</div>
